generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Expertise {
  id          String                @id @default(uuid())
  name        String                @unique
  instructors InstructorExpertise[]
}

model InstructorExpertise {
  id           String            @id @default(uuid())
  instructorId String
  expertiseId  String
  expertise    Expertise         @relation(fields: [expertiseId], references: [id])
  instructor   InstructorProfile @relation(fields: [instructorId], references: [id])
}

model User {
  id                String             @id @default(uuid())
  name              String
  email             String             @unique
  password          String
  role              Role               @default(ADMIN)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  lastLogin         DateTime?
  status            String             @default("ACTIVE")
  adminProfile      AdminProfile?
  coursesTaught     Course[]           @relation("InstructorCourses")
  instructorProfile InstructorProfile?
  studentProfile    StudentProfile?
  StudentApplication StudentApplication[]
}

model StudentProfile {
  id     String  @id @default(uuid())
  userId String  @unique
  grade  String?
  user   User    @relation(fields: [userId], references: [id])
}

model InstructorProfile {
  id                  String                @id @default(uuid())
  userId              String                @unique
  bio                 String?
  phone               String?
  rating              Float?
  status              InstructorStatus      @default(ACTIVE)
  students            Int?
  yearsOfExperience   Int?
  instructorExpertise InstructorExpertise[]
  user                User                  @relation(fields: [userId], references: [id])
}

model AdminProfile {
  id         String @id @default(uuid())
  userId     String @unique
  adminLevel Int?
  user       User   @relation(fields: [userId], references: [id])
}

model Category {
  id          String         @id @default(uuid())
  name        String
  description String
  status      CategoryStatus @default(ACTIVE)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  courses     Course[]
}

model Course {
  id                  String            @id @default(uuid())
  title               String
  shortDescription    String
  detailedDescription String
  imageUrl            String?
  priceOriginal       Float
  priceDiscounted     Float
  status              CourseStatus      @default(DRAFT)
  level               CourseLevel
  duration            String
  categoryId          String
  instructorId        String
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  category            Category          @relation(fields: [categoryId], references: [id])
  instructor          User              @relation("InstructorCourses", fields: [instructorId], references: [id])
  modules             CourseModule[]
  learningOutcomes    LearningOutcome[]
  prerequisites       Prerequisite[]
  StudentApplication  StudentApplication[]
}

model CourseModule {
  id       String         @id @default(uuid())
  courseId String
  title    String
  duration String
  order    Int
  lessons  CourseLesson[]
  course   Course         @relation(fields: [courseId], references: [id])
}

model CourseLesson {
  id       String       @id @default(uuid())
  moduleId String
  title    String
  duration String
  order    Int
  module   CourseModule @relation(fields: [moduleId], references: [id])
}

model LearningOutcome {
  id       String @id @default(uuid())
  courseId String
  text     String
  course   Course @relation(fields: [courseId], references: [id])
}

model Prerequisite {
  id       String @id @default(uuid())
  courseId String
  text     String
  course   Course @relation(fields: [courseId], references: [id])
}

model StudentApplication {
  id               String            @id @default(uuid())
  studentId        String
  student          User              @relation(fields: [studentId], references: [id])
  courseId         String
  course           Course            @relation(fields: [courseId], references: [id])
  paymentMethod    String
  paymentReference String
  status           ApplicationStatus @default(PENDING)
  submittedAt      DateTime          @default(now())
  reviewedAt       DateTime?
  reviewedBy       String? // Admin
  adminNotes       String?
  marketingSource  String?

  // Personal details
  fullName       String
  dateOfBirth    DateTime
  gender         String
  nationality    String? // newly added
  university     String?
  email          String
  phone          String
  telegramHandle String?
  address        String? // now optional

  // Receipt handling
  receiptUrl      String?
  receiptVerified Boolean @default(false)

  paymentOption   String? // newly added

  @@index([studentId])
  @@index([courseId])
}

enum Role {
  ADMIN
  SUPER_ADMIN
  INSTRUCTOR
  STUDENT
  SUPPORT
}

enum CategoryStatus {
  ACTIVE
  INACTIVE
}

enum CourseStatus {
  DRAFT
  PUBLISHED
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  ALL_LEVELS
}

enum InstructorStatus {
  ACTIVE
  INACTIVE
}

enum PaymentMethod {
  TELEBIRR
  CBE
  AMOLE
  OTHER
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}
